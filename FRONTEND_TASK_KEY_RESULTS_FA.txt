موضوع: تسک پیاده‌سازی - قابلیت‌های جدید Key Results

اولویت: بالا
زمان تخمینی: 2-3 روز
وضعیت بک‌اند: ✅ کامل و دیپلوی شده
وضعیت فرانت‌اند: ✅ پیاده‌سازی شده

---

پیاده‌سازی کامل شد:

همه 8 فیلد اختیاری جدید با موفقیت در فرانت پیاده‌سازی شدند.
برای مستندات کامل به KEY_RESULTS_IMPLEMENTATION.md مراجعه کنید.

---

خلاصه تسک:

پیاده‌سازی قابلیت‌های جدید Key Results با 8 فیلد اختیاری. APIهای بک‌اند آماده و تست شده‌اند. کار شما آپدیت فرانت برای ساپورت این قابلیت‌هاست.

---

چیزهای جدید:

Key Results حالا این فیلدهای اختیاری رو ساپورت می‌کنه:
1. description - توضیحات تکمیلی
2. current_value - مقدار فعلی پیشرفت
3. unit - واحد اندازه‌گیری (درصد، عدد، تومان و...)
4. owner_id - مسئول (از اعضای تیم)
5. due_date - تاریخ سررسید
6. labels - برچسب‌ها برای دسته‌بندی
7. Progress Updates - تاریخچه پیشرفت با یادداشت
8. Attachments - آپلود فایل

---

تغییرات بک‌اند:

✅ بهبود POST /api/objectives/:id/keyresults
   - حالا 8 فیلد جدید اختیاری قبول می‌کنه
   - فقط title و target_value الزامی هستن

✅ بهبود PUT /api/keyresults/:id
   - همه فیلدها در آپدیت اختیاری هستن
   - updated_at برمی‌گردونه

✅ جدید POST /api/keyresults/:id/progress
   - اضافه کردن آپدیت پیشرفت با value و note اختیاری
   - به صورت خودکار current_value رو آپدیت می‌کنه

✅ جدید GET /api/keyresults/:id/progress
   - دریافت تاریخچه پیشرفت

✅ جدید POST /api/keyresults/:id/attachments
   - آپلود فایل (multipart/form-data)

✅ جدید GET /api/keyresults/:id/attachments
   - لیست همه فایل‌ها

✅ جدید DELETE /api/keyresults/attachments/:id
   - حذف فایل

---

الزامات پیاده‌سازی:

1. آپدیت فرم‌های ایجاد/ویرایش:
   - اضافه کردن فیلدهای اختیاری به فرم ایجاد
   - اضافه کردن فیلدهای اختیاری به فرم ویرایش
   - همه فیلدهای جدید باید به وضوح اختیاری مشخص باشن
   - پیاده‌سازی dropdown انتخاب واحد (درصد، عدد، تومان، ساعت، روز)
   - پیاده‌سازی selector انتخاب مسئول (از اعضای تیم)
   - پیاده‌سازی date picker برای due_date
   - پیاده‌سازی input برچسب (مثل task labels)

2. آپدیت نمایش Key Result:
   - نمایش description اگر وجود داشته باشه
   - نمایش current_value با سمبل واحد
   - نمایش آواتار/اسم مسئول اگر تخصیص داده شده
   - نمایش due date با اندیکیتور بصری اگر نزدیک باشه
   - نمایش labels به صورت badge
   - اضافه کردن progress bar (current_value / target_value)

3. پیاده‌سازی Progress Tracking:
   - ساخت modal/form "افزودن پیشرفت"
   - Input: value (الزامی), note (اختیاری)
   - نمایش timeline تاریخچه پیشرفت
   - نمایش اینکه کی هر آپدیت رو زده و کی
   - نمایش بصری تفاوت بین آپدیت‌ها

4. پیاده‌سازی Attachments:
   - اضافه کردن دکمه/dropzone آپلود فایل
   - نمایش لیست فایل‌ها با آیکون
   - نمایش نام فایل، سایز، آپلودکننده، تاریخ
   - پیاده‌سازی قابلیت دانلود
   - پیاده‌سازی حذف با تأیید

5. آپدیت نمای کارت/لیست Key Result:
   - نمایش درصد پیشرفت
   - نمایش آواتار مسئول
   - نمایش badge تاریخ سررسید
   - نمایش badge های برچسب
   - اضافه کردن اندیکیتور بصری برای موارد سررسید گذشته

---

مثال‌های API:

ایجاد با همه فیلدها:
POST /api/objectives/{id}/keyresults
{
  "title": "افزایش فروش",
  "description": "افزایش فروش محصولات دیجیتال",
  "initial_value": 0,
  "current_value": 25,
  "target_value": 100,
  "unit": "percent",
  "owner_id": "user-uuid",
  "due_date": "2025-12-31",
  "labels": ["Q1", "فروش", "اولویت بالا"]
}

اضافه کردن پیشرفت:
POST /api/keyresults/{id}/progress
{
  "value": 45.5,
  "note": "پیشرفت خوبی داشتیم این هفته"
}

آپلود فایل:
POST /api/keyresults/{id}/attachments
Content-Type: multipart/form-data
Body: file={File}

---

انواع واحد (پیشنهادی):

const UNIT_TYPES = {
  number: { label: 'عدد', symbol: '' },
  percent: { label: 'درصد', symbol: '%' },
  currency: { label: 'تومان', symbol: '﷼' },
  hours: { label: 'ساعت', symbol: 'h' },
  days: { label: 'روز', symbol: 'd' },
  users: { label: 'کاربر', symbol: '' },
  items: { label: 'مورد', symbol: '' }
};

---

نکات UI/UX:

- فرم‌ها رو تمیز نگه دارید - از بخش‌های تاشو برای فیلدهای اختیاری استفاده کنید
- یک toggle "گزینه‌های پیشرفته" برای description، unit، owner، due date نشون بدید
- آپدیت‌های پیشرفت باید راحت در دسترس باشن ولی مزاحم نباشن
- فایل‌ها باید drag & drop ساپورت کنن
- برچسب‌ها باید autocomplete از برچسب‌های موجود داشته باشن
- Progress bar باید برجسته و رنگ‌بندی شده باشه (سبز: روی مسیر، زرد: در خطر، قرمز: عقب افتاده)
- هشدار due date: badge نشون بده اگر کمتر از 7 روز مونده
- Empty states: پیام‌های راهنما وقتی هیچ آپدیت پیشرفت یا فایلی نیست

---

اعتبارسنجی:

- title: الزامی، حداکثر 255 کاراکتر
- target_value: الزامی، باید عدد باشه
- current_value: اختیاری، باید <= target_value باشه
- initial_value: اختیاری، باید <= target_value باشه
- due_date: اختیاری، باید تاریخ معتبر باشه
- owner_id: اختیاری، باید کاربر معتبر از سازمان باشه
- labels: اختیاری، آرایه از رشته‌ها
- unit: اختیاری، رشته
- description: اختیاری، متن

---

چک‌لیست تست:

□ ایجاد key result فقط با فیلدهای الزامی (title, target_value)
□ ایجاد key result با همه فیلدهای اختیاری
□ ویرایش key result و آپدیت هر فیلد به صورت جداگانه
□ اضافه کردن آپدیت پیشرفت بدون یادداشت
□ اضافه کردن آپدیت پیشرفت با یادداشت
□ مشاهده تاریخچه پیشرفت
□ آپلود فایل (PDF، عکس، سند)
□ دانلود فایل
□ حذف فایل
□ اضافه کردن چند برچسب
□ حذف برچسب‌ها
□ تغییر مسئول
□ تنظیم تاریخ سررسید
□ پاک کردن فیلدهای اختیاری (null کردن)
□ بررسی محاسبه progress bar
□ تست با واحدهای مختلف
□ بررسی هشدارهای due date
□ بررسی مجوزها (فقط سازنده objective می‌تونه ویرایش کنه)

---

مستندات:

مستندات کامل API: KEY_RESULTS_ENHANCEMENT.md
مثال‌ها و schemaهای کامل در سند موجوده.

---

نکات:

- بک‌اند کاملاً تست شده و دیپلوی شده
- همه endpointها پیام خطای مناسب برمی‌گردونن
- آپلود فایل محدود به 10MB
- فایل‌ها در /uploads/key-results/ ذخیره میشن
- برچسب‌ها از سیستم موجود label استفاده می‌کنن (مثل tasks)
- آپدیت‌های پیشرفت immutable هستن (نمیشه ویرایش/حذف کرد)
- مسئول باید از همون سازمان باشه
- همه timestampها ISO 8601

---

سوال دارید؟

KEY_RESULTS_ENHANCEMENT.md رو چک کنید برای:
- مشخصات کامل API
- مثال‌های request/response
- مثال‌های کامپوننت فرانت
- الگوهای error handling

---

معیارهای پذیرش:

✅ همه 8 فیلد جدید در فرم‌های ایجاد/ویرایش ساپورت میشن
✅ Progress tracking کاربردی و intuitive هست
✅ فایل‌ها میشه آپلود، مشاهده و حذف کرد
✅ برچسب‌ها کار می‌کنن (autocomplete در آینده)
✅ نمایش بصری پیشرفت واضح و دقیقه
✅ هشدارهای due date قابل مشاهده‌اند
✅ تخصیص مسئول درست کار می‌کنه
✅ انواع واحد با سمبل‌هاشون درست نمایش داده میشن
✅ همه فیلدهای اختیاری میشه پاک/حذف کرد
✅ فرم‌ها درست اعتبارسنجی می‌کنن
✅ پیام‌های خطا user-friendly هستن
✅ Loading stateها پیاده‌سازی شدن
✅ موبایل responsive هست

فایل‌های ایجاد شده:
- src/services/keyResultService.js
- src/constants/keyResultUnits.js
- src/components/EnhancedKeyResultForm.jsx + .css
- src/components/EnhancedKeyResultCard.jsx + .css
- src/components/KeyResultProgressModal.jsx + .css
- src/components/KeyResultAttachments.jsx + .css
- src/components/ObjectivesEnhanced.jsx
- KEY_RESULTS_IMPLEMENTATION.md

---

اولویت‌بندی:

1. آپدیت فرم‌های ایجاد/ویرایش با فیلدهای جدید (روز 1)
2. پیاده‌سازی UI ردیابی پیشرفت (روز 1-2)
3. پیاده‌سازی فایل‌ها (روز 2)
4. آپدیت نمایش/visualization (روز 2-3)
5. Polish و تست (روز 3)

---

موفق باشید! تیم بک‌اند برای هر سوالی در دسترس هستن.
